<html>
<head>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.js"></script>
  <script type="text/javascript" src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/14082/FileSaver.js"></script>
  <style type="text/css">
  body {
    background: #20262E;
    padding: 20px;
    font-family: Helvetica;
  }

  #banner-message {
    background: #fff;
    border-radius: 4px;
    padding: 20px;
    font-size: 25px;
    text-align: center;
    transition: all 0.2s;
    margin: 0 auto;
  }

  button {
    background: #0084ff;
    border: none;
    border-radius: 5px;
    padding: 8px 14px;
    font-size: 15px;
    color: #fff;
  }

  #banner-message.alt {
    background: #0084ff;
    color: #fff;
    margin-top: 40px;
    width: 200px;
  }

  #banner-message.alt button {
    background: #fff;
    color: #000;
  }
  </style>
</head>
<body>
  <div id="banner-message">
  <p>RTRA helper</p>
  <div>
    <select id="ScriptSelector">
    <option>Select a script</option>
    <option value="Counts">Counts</option>
    <option value="Percentage">Percentage</option>
    <option value="PercentBrokenDown">Percentage broken down by a variable</option>
    </select>
  </div>

  <fieldset id="scriptOptions">
    <div id="datasetName">
      <label>Dataset name</label>
      <input type="text" />
    </div>

    <div id="variables">
      <label>Variable(s)</label>
      <input type="text" />
    </div>

    <div id="statisticBreakdown">
      <label>Statistic breakdown by this var</label>
      <input type="text" />
    </div>

    <div id="weightVariable">
      <label>Weight variable name</label>
      <input type="text" />
    </div>

    <div id="outputFileName">
      <label>Ouput file name</label>
      <input type="text" />
    </div>
  </fieldset>

  <div>
    <button>Generate RTRA program</button>
  </div>
  <div>
    <textarea id="output"></textarea>
  </div>
</div>

<script type="text/javascript">
var scriptOpts = {
"Counts": {
  template(args) {
    return `Data Work.${args.datasetName};
    Set RTRAData.${args.datasetName};
    %RTRAFreq (InputDataset=work.${args.datasetName}, OutputName=${args.outputFileName}, ClassVarList=${args.variables}, UserWeight=${args.weightVariable});`;
  },
  options: [
    "datasetName",
    "variables",
    "weightVariable",
    "outputFileName"
  ]
},
Percentage: {
      template(args) {
    return `Data Work.${args.datasetName};
    Set RTRAData.${args.datasetName};
    %RTRAFreq (InputDataset=work.${args.datasetName}, OutputName=${args.outputFileName}, ClassVarList=${args.variables},`;
  },
  options: [
    "datasetName",
    "variables",
    "outputFileName"
  ]
},
"PercentBrokenDown": {
  template(args) {
    return `Data Work.${args.datasetName};
    Set RTRAData.${args.datasetName};
    %RTRAFreq (InputDataset=work.${args.datasetName}, OutputName=${args.outputFileName}, ClassVarList=${args.variables},`;
  },
  options: [
    "datasetName",
    "variables",
    "outputFileName"
  ]
}
};

$(function() {
// find elements
var banner = $("#banner-message");
var button = $("button");
var output = $("#output");
var ss = $("#ScriptSelector");
var so = $("#scriptOptions");

so.find('div').hide();

// handle click and add class
ss.on("change", () => {
  so.find('div').hide();
  var selectedScript = ss.val();
  var selectedObject = scriptOpts[selectedScript] || {};
  var options = selectedObject.options || [];

  options.forEach((optionToShow) => $(`#${optionToShow}`).show());
});

button.on("click", ()=> {
  var selectedScript = ss.val();
  if (!(selectedScript in scriptOpts)){
  alert('select a valid option');
  return;
  }
  var selected = scriptOpts[selectedScript];

  var args = {};
  var success = selected.options.every((option) =>
  {
    args[option] = $(`#${option} input`).val();

    if (args[option].length === 0) {
      const optionLabel = $(`#${option} label`).text();
      alert(`You missed an option: "${optionLabel}"`);
      $(`#${option} input`).focus();
      return false;
    }

    return true;
  });

  if (!success) {
    return;
  }

  var text = selected.template(args);
  var blob = new Blob([text], {type: "text/plain;charset=utf-8"});
  // uncomment the next line to debug;
  // output.text(text);
  saveAs(blob, args.datasetName+".sas");

})
});

</script>

</body>
</html>
